<!DOCTYPE html>
<html>
<head>
    <title>English Mania LIFF</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
    <button id="loginButton">Login with Line</button>
    <pre id="result"></pre>

    <script>
        async function main() {
            try {
                await liff.init({ liffId: "2006541812-gMvB1l0P" });
                if (!liff.isLoggedIn()) {
                    liff.login();
                } else {
                    document.getElementById("result").innerText = "Loading...";
                    const idToken = liff.getIDToken();
                    const res = await fetch("https://api.englishmaniaasia.com/auth/line", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ id_token: idToken })
                    });
                    if (!res.ok) {
                        throw new Error(`HTTP error! status: ${res.status}`);
                    }
                    const data = await res.json();
                    document.getElementById("result").innerText = JSON.stringify(data, null, 2);
                }
            } catch (error) {
                document.getElementById("result").innerText = `Error: ${error.message}`;
            }
        }

        document.getElementById("loginButton").addEventListener("click", main);
        main();
    </script>
</body>
</html>
